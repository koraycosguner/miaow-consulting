<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Single-Point Price Optimizer</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #990000; /* IU Crimson */
            --text-main: #111827;
            --text-light: #4b5563;
            --bg: #f9fafb;
            --surface: #ffffff;
            --border: #e5e7eb;
            --highlight: #eff6ff;
            --highlight-border: #bfdbfe;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 0 20px 40px;
            line-height: 1.6;
        }

        .container { max-width: 1000px; margin: 0 auto; }
        
        /* Typography */
        h1 { font-size: 2.2rem; font-weight: 800; margin: 0 0 10px 0; letter-spacing: -0.02em; text-align: center; }
        .subtitle { font-size: 1.1rem; color: var(--text-light); text-align: center; margin-bottom: 40px; }
        
        h2 { font-size: 1.5rem; font-weight: 700; color: var(--text-main); margin-top: 0; border-bottom: 1px solid var(--border); padding-bottom: 10px; margin-bottom: 20px; }
        h3 { font-size: 1.1rem; font-weight: 700; color: var(--primary); margin-bottom: 15px; margin-top: 0; }
        p { margin-bottom: 15px; color: var(--text-light); font-size: 0.95rem; line-height: 1.6; }

        /* Theory Section */
        .theory-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
        }

        .theory-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 60px;
            align-items: start;
        }

        /* Formula Box */
        .formula-box {
            background: var(--bg); border: 1px solid var(--border); padding: 20px; border-radius: 8px; 
            font-family: monospace; font-size: 0.95rem; color: #1f2937; margin: 15px 0; text-align: left;
        }
        
        .step-math { display: block; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px dashed #e5e7eb; }
        .step-math:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .step-label { color: var(--primary); font-weight: bold; margin-right: 10px; display:inline-block; }
        .step-desc { display: block; font-family: sans-serif; font-size: 0.85rem; color: #6b7280; margin-top: 4px; font-style: italic; }

        /* Illustration Container */
        .illustration-container {
            text-align: center;
            background: #fafafa;
            border-radius: 12px;
            border: 1px solid var(--border);
            padding: 10px;
            margin-bottom: 20px;
            width: 100%;
            box-sizing: border-box;
        }
        .illustration-caption { font-size: 0.85rem; color: #9ca3af; margin-top: 5px; font-style: italic; }
        
        svg { width: 100%; height: auto; display: block; max-height: 220px; }

        /* Example Box */
        .example-box {
            background: #f3f4f6;
            border-left: 4px solid #6b7280;
            padding: 15px;
            font-size: 0.9rem;
            color: #374151;
            margin-top: 10px;
        }

        /* Strategic Context */
        .context-box {
            grid-column: 1 / -1;
            background: var(--highlight);
            border: 1px solid var(--highlight-border);
            border-radius: 8px;
            padding: 25px;
            margin-top: 30px;
        }
        .context-title { font-weight: 700; color: #1e3a8a; margin-bottom: 10px; font-size: 1.1rem; }
        .context-text { color: #1e40af; font-size: 0.95rem; line-height: 1.6; }

        /* Calculator Section */
        .calculator-section {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
            align-items: start;
        }

        .sidebar {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
        }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; font-size: 0.9rem; font-weight: 600; margin-bottom: 8px; color: var(--text-main); }
        .input-group input { width: 100%; padding: 10px 12px; border: 1px solid var(--border); border-radius: 6px; font-size: 1rem; box-sizing: border-box; }
        .input-hint { font-size: 0.8rem; color: var(--text-light); margin-top: 4px; }
        .btn-calc {
            background: var(--primary); color: white; border: none; padding: 14px 28px; border-radius: 8px; font-size: 1rem; font-weight: 700;
            cursor: pointer; width: 100%; transition: background 0.2s; margin-top: 10px; width: 100%;
        }
        .btn-calc:hover { background: #7a0000; }

        .results-area { display: none; animation: fadeIn 0.5s ease-out; }
        .metrics-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .metric-card { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 20px; text-align: center; border-top: 4px solid #2563eb; }
        .card-opt { border-top: 4px solid var(--primary); background: #fffcfc; }
        .metric-title { font-size: 0.85rem; color: var(--text-light); font-weight: 700; text-transform: uppercase; margin-bottom: 8px; }
        .metric-value { font-size: 1.8rem; font-weight: 800; color: var(--text-main); }
        .metric-sub { font-size: 0.85rem; color: #059669; font-weight: 600; margin-top: 5px; }
        
        .chart-container { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px; height: 400px; position: relative; }
        
        .footer { margin-top: 60px; text-align: center; font-size: 0.85rem; color: #9ca3af; border-top: 1px solid var(--border); padding-top: 20px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        @media (max-width: 800px) { .calculator-section, .metrics-grid, .theory-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
<!-- Auth check -->
<div id="loading-screen" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: white; display: flex; align-items: center; justify-content: center; z-index: 9999;">
    <p style="color: #64748b;">Loading...</p>
</div>
<div id="main-content" style="display: none;">

<div style="max-width: 1000px; margin: 0 auto; padding: 20px 20px 20px;">
    <a href="tools.html" style="display: inline-flex; align-items: center; gap: 6px; color: #64748b; text-decoration: none; font-size: 0.9rem; font-weight: 500;">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 16px; height: 16px; flex-shrink: 0;"><path d="m15 18-6-6 6-6"/></svg>
        Back to Pricing & Analytics Tools
    </a>
</div>

<div class="container">
    
    <h1>Single-Point Price Optimizer</h1>
    <div class="subtitle">Based on Estimated Elasticity and a Single Price/Demand Point</div>

    <div class="theory-section">
        <h2>Theoretical Background</h2>
        
        <div class="theory-grid">
            <div>
                <h3>1. Origin: The Log-Log Model</h3>
                <p>
                    When historical data is available, analysts run a regression on the <strong>natural logs (ln)</strong> of Price and Sales.
                </p>
                <div class="formula-box">
                    <strong>ln(Sales) = a + b · ln(Price)</strong>
                </div>
                <p>
                    <strong>Why use logs?</strong> While the raw relationship between Price and Sales is a curve, the relationship between <em>ln(Price)</em> and <em>ln(Sales)</em> is a straight line. This transformation allows us to use standard linear regression to find the elasticity (slope <strong>b</strong>).
                </p>
                <p>
                    To use this for prediction (in real units like units/dollars), we perform an algebraic transformation:
                </p>
                
                <div class="formula-box">
                    <span class="step-math">
                        <span class="step-label">Step 1</span>
                        <strong>Sales = e<sup>(a + b·ln(P))</sup></strong>
                        <span class="step-desc">We take the exponential (<i>exp</i>) of both sides.</span>
                    </span>
                    <span class="step-math">
                        <span class="step-label">Step 2</span>
                        <strong>Sales = e<sup>a</sup> · (e<sup>ln(P)</sup>)<sup>b</sup></strong>
                        <span class="step-desc">Using algebra rules to separate terms. (Note: e<sup>ln(P)</sup> = P).</span>
                    </span>
                    <span class="step-math" style="border:none;">
                        <span class="step-label">Step 3</span>
                        <strong>Q = A · P<sup>E</sup></strong>
                        <span class="step-desc">
                            We simplify by relabeling:<br>
                            • Sales &rarr; <strong>Q</strong><br>
                            • e<sup>a</sup> &rarr; <strong>A</strong> (Scale Factor)<br>
                            • b &rarr; <strong>E</strong> (Elasticity)
                        </span>
                    </span>
                </div>
            </div>

            <div>
                <h3>2. Result: The Power Demand Curve</h3>
                <p>
                    The result of that derivation is the <strong>Power Demand Curve</strong>. Unlike a linear model (which subtracts units), this model multiplies by percentages. This ensures demand never drops below zero, even at very high prices.
                </p>
                
                <div class="illustration-container">
                    <svg viewBox="0 0 300 180" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">
                        <line x1="30" y1="160" x2="280" y2="160" stroke="#374151" stroke-width="2"/> <line x1="30" y1="160" x2="30" y2="20" stroke="#374151" stroke-width="2"/>   <text x="270" y="175" font-family="sans-serif" font-size="10" fill="#374151" font-weight="bold">Price</text>
                        <text x="20" y="15" font-family="sans-serif" font-size="10" fill="#374151" font-weight="bold" text-anchor="middle">Qty</text>
                        
                        <path d="M 40 30 Q 80 140, 270 140" stroke="#990000" stroke-width="3" fill="none"/>
                        
                        <text x="150" y="60" font-family="sans-serif" font-size="14" fill="#990000" font-weight="bold">Q = A · P<tspan dy="-5" font-size="10">E</tspan></text>
                    </svg>
                    <div class="illustration-caption">Figure 1: Illustrative Power Demand Curve</div>
                </div>

                <h3>3. Prediction Example</h3>
                <p>
                    Because elasticity is constant, we predict sales using the ratio of the price change:
                </p>
                <div class="formula-box" style="text-align:center; padding:10px;">
                    <strong>Q<sub>new</sub> = Q<sub>old</sub> × (P<sub>new</sub> / P<sub>old</sub>)<sup>E</sup></strong>
                </div>
                
                <div class="example-box">
                    <strong>Numerical Example:</strong><br>
                    • Start: Price = $20, Sales = 1,000 units.<br>
                    • Change: Raise Price to $22. Elasticity = -2.0.<br>
                    <br>
                    1. <strong>Ratio:</strong> 22 / 20 = 1.10 (10% increase)<br>
                    2. <strong>Power:</strong> 1.10<sup>-2</sup> = 0.8264<br>
                    3. <strong>Result:</strong> 1,000 × 0.8264 = <strong>826 units</strong>
                </div>
            </div>

            <div class="context-box">
                <div class="context-title">Strategic Context: When to use this tool?</div>
                <div class="context-text">
                    This tool bridges the gap when you face a <strong>Data Limitation</strong>:
                    <br><br>
                    <ul style="margin:0; padding-left:20px;">
                        <li style="margin-bottom:10px;">
                            <strong>Scenario A: You have historical data.</strong> (Sales at $10, $12, $15...).<br>
                            You don't need this calculator. Run the Ln-Ln regression above to find your exact parameters.
                        </li>
                        <li>
                            <strong>Scenario B: You have NO data.</strong> (You only know you sell 1,000 units at $20).<br>
                            You cannot run a regression. Instead, you estimate an elasticity (using Tool 2) and use the calculator below. It uses the Power Function logic to extrapolate the entire demand curve from your single data point.
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="calculator-section">
        
        <div class="sidebar">
            <h3 style="margin-top:0;">Calculator Inputs</h3>
            <p style="font-size:0.9rem; margin-bottom:20px;">Enter your single known data point and estimated elasticity.</p>
            
            <div class="input-group">
                <label>Current Price ($)</label>
                <input type="number" id="p1" placeholder="e.g. 20.00" step="0.01">
            </div>

            <div class="input-group">
                <label>Current Quantity</label>
                <input type="number" id="q1" placeholder="e.g. 1000">
            </div>

            <div class="input-group">
                <label>Estimated Elasticity (E)</label>
                <input type="number" id="elast" placeholder="e.g. -2.0" step="0.1">
                <div class="input-hint">Must be negative (e.g., -2).</div>
            </div>

            <div class="input-group">
                <label>Variable Cost ($)</label>
                <input type="number" id="vc" placeholder="e.g. 10.00" step="0.01">
            </div>

            <button class="btn-calc" onclick="calculate()">Run Optimization</button>
        </div>

        <div class="results-area" id="results">
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-title">Current Profit</div>
                    <div class="metric-value" id="res-curr-profit">--</div>
                    <div class="metric-sub" id="res-curr-margin">--</div>
                </div>

                <div class="metric-card card-opt">
                    <div class="metric-title">Optimal Price</div>
                    <div class="metric-value" id="res-opt-price">--</div>
                    <div class="metric-sub" id="res-opt-profit">--</div>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="optChart"></canvas>
            </div>

            <div id="warning-msg" style="margin-top:20px; color:#b91c1c; background:#fef2f2; padding:15px; border-radius:8px; display:none;"></div>

        </div>

    </div>

    <div class="footer">
        Created by Dr. Koray Cosguner with the help of Gemini 3.0.
    </div>

</div>

<script>
    let myChart = null;

    function calculate() {
        // 1. Inputs
        const p1 = parseFloat(document.getElementById('p1').value);
        const q1 = parseFloat(document.getElementById('q1').value);
        const E = parseFloat(document.getElementById('elast').value);
        const C = parseFloat(document.getElementById('vc').value);

        if ([p1, q1, E, C].some(isNaN)) {
            alert("Please fill in Price, Quantity, Elasticity, and Cost.");
            return;
        }

        if (E >= -1) {
            showWarning("<strong>Warning: Inelastic Demand (|E| < 1).</strong><br>The math suggests raising prices indefinitely because customers aren't price sensitive enough to hurt your total profit. An optimal finite price does not exist in this model.");
        } else {
            hideWarning();
        }

        // 2. Define the Demand Function: Q = A * P^E
        // We find A (Scale Factor) based on current state
        const A = q1 / Math.pow(p1, E);

        // Helper: Calculate Q and Profit for any P
        const calcState = (p) => {
            const q = A * Math.pow(p, E);
            const prof = (p - C) * q;
            return { p, q, prof };
        };

        // 3. Current State
        const current = calcState(p1);

        // 4. Optimal State (Markup Rule)
        // P* = C * (E / (1+E))
        let optimal = { p: 0, q: 0, prof: 0 };
        
        if (E < -1) {
            const optPrice = C * (E / (1 + E));
            optimal = calcState(optPrice);
        } else {
            optimal.p = NaN;
        }

        // 5. Update UI
        document.getElementById('results').style.display = 'block';
        const fmt = (n) => "$" + n.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});

        // Current Card
        document.getElementById('res-curr-profit').innerText = fmt(current.prof);
        document.getElementById('res-curr-margin').innerText = "Margin: " + fmt(p1 - C);

        // Optimal Card
        if (!isNaN(optimal.p)) {
            document.getElementById('res-opt-price').innerText = fmt(optimal.p);
            document.getElementById('res-opt-profit').innerText = "Max Profit: " + fmt(optimal.prof);
        } else {
            document.getElementById('res-opt-price').innerText = "Raise Price";
            document.getElementById('res-opt-profit').innerText = "Demand is Inelastic";
        }

        // 6. Charting
        drawChart(A, E, C, p1, optimal.p);
    }

    function showWarning(msg) {
        const el = document.getElementById('warning-msg');
        el.style.display = 'block';
        el.innerHTML = msg;
    }
    function hideWarning() {
        document.getElementById('warning-msg').style.display = 'none';
    }

    function drawChart(A, E, C, currentP, optP) {
        const ctx = document.getElementById('optChart').getContext('2d');
        
        let centerP = currentP;
        if (!isNaN(optP)) {
            centerP = (currentP + optP) / 2;
        }
        
        const startP = Math.max(0.1, centerP * 0.5); 
        const endP = centerP * 1.5;
        const steps = 50;
        const stepSize = (endP - startP) / steps;

        let labels = [];
        let profitData = [];

        for (let i = 0; i <= steps; i++) {
            const p = startP + (i * stepSize);
            const q = A * Math.pow(p, E);
            const profit = (p - C) * q;
            
            labels.push(p.toFixed(2));
            profitData.push(profit);
        }

        if (myChart) myChart.destroy();

        const currPoint = [{x: currentP, y: (currentP-C)*(A*Math.pow(currentP, E))}];
        const optPoint = !isNaN(optP) ? [{x: optP, y: (optP-C)*(A*Math.pow(optP, E))}] : [];

        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Profit Curve',
                        data: profitData,
                        borderColor: '#990000',
                        backgroundColor: 'rgba(153, 0, 0, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 0
                    },
                    {
                        label: 'Current Price',
                        data: currPoint,
                        borderColor: '#2563eb',
                        backgroundColor: '#2563eb',
                        pointRadius: 6,
                        type: 'scatter'
                    },
                    {
                        label: 'Optimal Price',
                        data: optPoint,
                        borderColor: '#059669',
                        backgroundColor: '#059669',
                        pointRadius: 6,
                        type: 'scatter'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                if (context.dataset.type === 'scatter') return context.dataset.label + ": $" + context.raw.x.toFixed(2);
                                return "$" + context.parsed.y.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0});
                            }
                        }
                    }
                },
                scales: {
                    x: { type: 'linear', title: { display: true, text: 'Price ($)' }, ticks: { callback: function(val){ return '$' + val; } } },
                    y: { title: { display: true, text: 'Profit ($)' } }
                }
            }
        });
    }
</script>

</div> <!-- end main-content -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBg3LJDwVIRGWtFZb_mM_CSRJMNCJUta20",
        authDomain: "iu-pricing-tools.firebaseapp.com",
        projectId: "iu-pricing-tools",
        storageBucket: "iu-pricing-tools.firebasestorage.app",
        messagingSenderId: "659335573790",
        appId: "1:659335573790:web:00013a166787efecb3d90f",
        measurementId: "G-NGKNY08XWP"
    };
    firebase.initializeApp(firebaseConfig);
    firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
        } else {
            window.location.href = 'login.html';
        }
    });
</script>

</body>
</html>